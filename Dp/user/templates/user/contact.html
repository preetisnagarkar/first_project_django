{% extends 'user/basic.html' %}

{% block title %} Contact Us{% endblock %}
{% block body %}
<!-- Create form for contact -->
<div class="container" style="padding-left: 20%;padding-bottom: 5%">
    
        <div class="col-lg-10 mt-1 mb-4" style="width: 80%" >
          <h2>Contact Us<br></h2>
          <form action="/user/contact/" method="post"> {% csrf_token %}
          <div class="form-group">
              <label for="name">Name</label>
              <input type="text" class="form-control" id="name" name="name" placeholder="Enter your name">
          </div>
          <div class="form-group">
              <label for="email">Email</label>
              <input type="email" class="form-control" id="email" name="email" placeholder="Enter your Email">
          </div>
          <div class="form-group">
              <label for="phone_no">Phone No.</label>
              <input type="tel" class="form-control" id="phone_no" name="phone" placeholder="Enter your Phone no.">
          </div>
          <div class="form-group">
              <label for="desc">Describe</label>
              <textarea class="form-control" id="desc" name="desc" rows="3"></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Submit</button>
          </form>
        </div>
    
</div>


   {% endblock %}

{% block js %}
<script>
  if(localStorage.getItem('cart')==null){
  var cart = {}
 }
 else
 {
  cart = JSON.parse(localStorage.getItem('cart'));
  
 }
 console.log(cart);
 var sum = 0;
 var amount = 0;
 var totalPrice = 0;
 var gtotalPrice = 0;

 var i=1;
 if ($.isEmptyObject(cart)){
    mystr = 'your cart is empty'
    $('#items').append(mystr);
 }
 else
 {

   for (item in cart){

    let name = cart[item][1];
    let qty = cart[item][0];
    let itemPrice = cart[item][2];
    let amount = cart[item][3];
    let gtotalPrice = cart[item][4];
    sum = sum + qty;
    amount = itemPrice * qty;
    totalPrice = totalPrice + amount;

    // let price = 
    // mystr =`<li class="list-group-item d-flex justify-content-between align-item-center">${name}<span class="badge badge-primary badge-pill">${qty}</span></li>`
    mystr = `<tr>
          <th scope="row">${i}</th>
          <td>${name}</td>
          <td>${itemPrice}</td>
          <td>${qty}</td>
          <td>${amount}</td>
        </tr>`
    $('#items').append(mystr);
    i = i+1;
   }
   if(totalPrice>700)
    {
      var cvcharge=0;
      gtotalPrice = totalPrice + cvcharge;
      console.log(totalPrice);
      console.log(gtotalPrice);
    }
    else
    {
      var cvcharge=70;
      gtotalPrice = totalPrice + cvcharge;
      console.log(totalPrice);
      console.log(gtotalPrice);
    }
    console.log(totalPrice);
    console.log(gtotalPrice);
    

 }
 document.getElementById('cart').innerHTML = sum;
 document.getElementById('totalPrice').innerHTML = totalPrice;
 document.getElementById('gtotalPrice').innerHTML = gtotalPrice;

 function updatePopover(cart){
  console.log('we are in popover');
  var popStr = "";
  popStr = popStr + "<h5> Cart for your items</h5>";
  var i = 1;
  for (var item in cart){
    popStr = popStr + "<b>" + i + "</b>. ";
    popStr = popStr + document.getElementById('name' + item).innerHTML + "Price:" + document.getElementById('price' + item).innerHTML + "Qty: " + cart[item][0] + '<br>';
    i = i+1;

  }
  popStr = popStr + "<a href='/user/checkout'><button class='btn btn-primary btn-sm mx-2' id='checkout'>Checkout</button></a>   <button class='btn btn-primary btn-sm mx-2' onclick='clearCart()' id='clearCart'>Clear Cart</button> "
  document.getElementById('popcart').setAttribute('data-content', popStr);
  // $('#popcart').popover('show');

}

function updateCart(cart){
  var sum = 0;
  for (var item in cart){
    sum = sum + cart[item][0];
    document.getElementById('div'+ item).innerHTML = "<button id='minus" + item + "' class='btn btn-primary minus'>-</button> <span id='val" + item + "''>" + cart[item][0] + "</span> <button id='plus" + item + "' class='btn btn-primary plus'> + </button>";
  }
  localStorage.setItem('cart', JSON.stringify(cart));
  document.getElementById('cart').innerHTML = sum;
  console.log(cart);
  updatePopover(cart);
}
  
function clearCart(){
  cart = JSON.parse(localStorage.getItem('cart'));
  for (var item in cart){
    // document.getElementById('div' + item).innerHTML = '<button id="'+ item +'" class="btn btn-primary cart">Add To Cart</button>';
    console.log(cart)
  }
  localStorage.clear();
  cart = {};
  updateCart(cart);
}

</script>

{% endblock %}